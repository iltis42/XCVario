#ifndef __ROUTER_H__
#define __ROUTER_H__

#include "RingBufCPP.h"

#include <freertos/FreeRTOS.h>
#include <freertos/semphr.h>


class SString;

/*
 *   Router for XCVario, to interconnect wireless (Bluetooth or WLAN), XCVario and serial S1,S2 interfaces
 *
 *
 *
 */


extern RingBufCPP<SString> wl_vario_tx_q;
extern RingBufCPP<SString> wl_flarm_tx_q;
extern RingBufCPP<SString> wl_aux_tx_q;
extern RingBufCPP<SString> wl_vario_rx_q;
extern RingBufCPP<SString> wl_flarm_rx_q;
extern RingBufCPP<SString> wl_aux_rx_q;

extern RingBufCPP<SString> bt_tx_q;
extern RingBufCPP<SString> bt_rx_q;

extern RingBufCPP<SString> s1_tx_q;
extern RingBufCPP<SString> s2_tx_q;

//extern RingBufCPP<SString> s1_rx_q;
//extern RingBufCPP<SString> s2_rx_q;

extern RingBufCPP<SString> xcv_tx_q;

extern RingBufCPP<SString> can_rx_q;  // for secondary variometer

extern RingBufCPP<SString> can_tx_q;

extern portMUX_TYPE btmux;


class Router {

public:
  Router() { };
  static void begin();
  // add message to queue and return true if succeeded
  static bool forwardMsg( SString &s, RingBufCPP<SString>& q, bool nmea=false );
  // gets last message from ringbuffer FIFO, return true if succeeded
  static bool pullMsg( RingBufCPP<SString>& q, SString& s );
  // get one big block max 512 byte
  static int pullBlock( RingBufCPP<SString>& q, char * block, int size );
  // Route messages generated by XCVario core
  static void routeXCV();
  // Route messages coming in from serial interface S1
  static void routeS1(SString& s1);
  // Route messages coming in from serial interface S2
  static void routeS2(SString& s2);
  // route messages coming in from WLAN
  static void routeWLAN();
  // route messages coming in from Bluetooth
  static void routeBT();
  // route messages coming in from CAN interface
  static void routeCAN();
  // add messages from XCVario to Router
  static void sendXCV(char * s);
  // add messages to WIFI AUX port 8882
  static void sendAUX(char * s);

  static void clearQueue( RingBufCPP<SString>& q );

private:

};

#endif
